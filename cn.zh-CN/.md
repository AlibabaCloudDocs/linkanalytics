---
keyword: [数据分析, 数据服务, 物联网, API, 系统级对接]
---

# 数据服务

为了更加便捷和充分地利用数据资产，您可在自己的服务器，调用数据服务下的基础服务API或新建自定义服务API，以获取所需数据，从而实现服务器与物联网平台的系统级对接。通过数据服务平台，您还可运维和监控API的使用情况。本文介绍数据服务及其使用方法。

## 背景信息

-   基础服务API：您可直接调用默认的基础服务API，获取指定的设备数据，例如：任意时间段内每日设备数量相关统计、历史至今设备数量相关统计等。更多信息，请参见下文的[查看与使用](#section_mky_acn_k91)。
-   自定义服务API：您可以根据业务需要，新建自定义服务API。具体操作，请见下文的[新建自定义API](#section_yjf_yqv_26y)。

## 前提条件

已创建数据源相关的指标和数据集，具体信息，请参见[指标概述]()。

## 新建自定义API

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。
2.  在实例概览页面，找到对应的数据型实例，单击实例进入实例详情页面。
3.  在左侧导航栏，选择**数据分析** \> **数据服务**。
4.  在**API列表**，单击**自定义服务API**，然后单击**新建API**。

    ![新建API](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6478394161/p245813.gif)

5.  在**新建API**页面，完成**API基本信息**的配置，然后单击**下一步**。

    ![API基本信息](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0996025161/p245814.gif)

    |参数|描述|
    |--|--|
    |API名称|输入API名称。支持中文、英文字母、数字、下划线（\_）。长度不超过30个字符。|
    |API Path|输入API 路径。调用API时，对应的参数名为apiPath。以正斜线（/）开头，支持英文字母、数字、下划线（\_）、正斜线（/）。长度不超过128个字符。例如：pk/temperatureMax。**说明：** API发布后，不可修改该参数。 |
    |API标签|输入标签内容后，按回车键，生成标签。使用标签功能，为API自定义标识，以便灵活管理API。一个API最多可添加5个标签。 |
    |API描述|输入API的描述，说明该API的功能等信息。|
    |返回类型|该参数不可自定义。调用API后，返回的数据格式为JSON。|

6.  在**配置参数并测试**页面，完成以下配置。

    |类别|参数|说明|
    |--|--|--|
    |数据源|指标域|选择指标域。指标域是指标所属的对象，用于分类管理指标。更多信息，请参见[什么是指标]()。|
    |数据集|选择对应指标域的数据集。数据集是指定指标域下设备数据的集合。更多信息，请参见[数据集概述]()。|
    |配置参数|数据集|完成数据源配置后，自动显示所选的数据集。单击**预览数据**，可跳转至该数据集的详情页。|
    |数据范围|选择API的数据范围。仅支持以下两项：    -   衍生指标：基于原始指标、原始定义、衍生定义，经过加和、平均等汇总计算方式得到的数据。
    -   衍生定义：以原始定义为基础，并应用到子实体上的原始定义指标的衍生。
更多信息，请参见[指标类型]()。 |
    |请求参数|单击**添加参数**，添加调用API的请求参数。请求参数可重复添加。添加的参数需包括绑定字段、参数名、参数类型、操作符、必选、示例值、参数描述。|
    |返回参数|单击**添加参数**，添加调用API时返回的参数。返回参数不可重复添加。添加的参数需包括优先级、绑定字段、参数名、参数类型、用于排序、示例值、参数描述。|
    |排序方式|    -   升序：参数以升序排列。默认排序为升序。
    -   降序：参数以降序排列。 |
    |高级设置|开启返回结果分页|    -   不开启：仅可查看200条以内的返回结果。
    -   开启：可分页查看所有返回结果。开启后，自动增加以下公共参数：
        -   pageNum：分页的页码。
        -   pageSize：每页显示结果的条数，最大值为200。
        -   totalNum：返回结果的总页数。仅返回参数中有此参数。 |
    |超时报错设置|设置返回超时报错的时间。取值范围为5000~8000，单位为毫秒。|

    完成上述配置后，在**测试API**区域内，输入请求参数的测试值后，单击**开始测试**。

    ![测试API](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7478394161/p245823.gif)

    您可在**返回示例**页签查看返回的示例数据，也可单击**请求详情**查看发起请求后的具体信息。

7.  单击**发布**。

    **说明：**

    -   发布API前，需确保该API已通过测试。
    -   仅单击**保存**的API，显示状态为未上线。
    -   未完成配置的API，可单击对应的**编辑**，完成配置后发布上线。
    -   仅可删除未上线和已下线的API，删除后7天内可[提交工单](https://selfservice.console.aliyun.com/ticket/category/iot/today)，申请恢复。
    在**发布成功**页面，单击**再次新建**，可创建多个自定义API；单击**去列表查看**，可查看已创建的API。

    ![发布成功](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7478394161/p245825.gif)


## 查看与使用

1.  在左侧导航栏，选择**数据分析** \> **数据服务**。
2.  在**数据服务**页面的API列表，单击**基础服务API**或**自定义服务API**页签，找到要查看的API，再单击对应API的**查看**。

    ![数据服务页面](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7478394161/p246224.gif)

3.  在API详情页的右上角，选择版本号，查看对应版本的API详情。

    -   在**API运维**页签，您可查看API的使用情况。
    -   单击**API测试**，您可测试API。
    -   根据API的详情信息，您可在自己的服务器集成并调用对应API，获取相关数据，以充分利用数据资产。

        在调用API时，需注意以下系统参数。调用示例，请参见[JAVA SDK调用示例](/cn.zh-CN/物联网数据分析（老版本）/数据资产/数据服务/JAVA SDK调用示例.md)。

        |名称|类型|是否必传|示例值|描述|
        |--|--|----|---|--|
        |apiPath|String|是|pk/temperatureMax|API路径。|
        |iotInstanceId|String|是|iot-cn-npk1u\*\*\*\*\*\*|实例ID。公共实例不传此参数，企业版实例需传入。|
        |pageNum|Integer|开启分页时必传|10|分页的页码。|
        |pageSize|Integer|开启分页时必传|100|每页显示结果的条数，最大值为200。|

    ![API详情页](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7478394161/p245896.gif)


