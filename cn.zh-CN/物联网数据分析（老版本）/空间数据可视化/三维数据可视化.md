# 三维数据可视化

三维数据可视化服务通过空间建模展示设备实时状态，方便您查看设备状态并进行管理。

三维数据可视化主要功能包括：

-   支持拖拽建模；
-   支持IoT设备联动；
-   支持空间搜索。

三维数据可视化服务的操作视频请参见[三维数据可视化视频演示](/cn.zh-CN/物联网数据分析（老版本）/视频演示/三维数据可视化.md)。

## 创建场景

1.  登录[物联网平台控制台](https://iot.console.aliyun.com/)，单击**数据分析** \> **实验室**。

2.  在实验室功能模板中，定位到**空间数据可视化**，并单击**查看详情**。

3.  在空间数据可视化页面，单击**三维数据可视化**。

    ![三维数据可视化首页](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1917649951/p57217.png)

    **说明：** 若您首次使用三维数据可视化服务，物联网数据分析会为您提供一个三维数据可视化体验示例，您可以根据示例创建您的第一个三维数据可视化场景。

4.  （可选）若需要自主制作场景模型，则在编辑器下载处，下载模型编辑器后，使用模型编辑器制作您的场景模型。

    **说明：** 若使用三维数据可视化服务提供的云端场景模型，则无需操作此步骤。在下方步骤4创建场景时，场景模型选择云端创建即可。

    场景模型的制作，请参考[搭建工具手册](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/attach/91480/cn_zh/1537238846836/CampusBuilder搭建工具用户手册.pdf)。

    搭建好场景后，单击编辑器上方导航栏中的 **文件** \> **导出**，选择**ThingJS场景包**保存资源包到本地备用。

5.  在**三维数据可视化**页面，单击`+`图标创建场景。

6.  根据参数说明设置场景参数，并单击**确定**。

    ![创建三维场景](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1917649951/p44100.png)

    |参数|说明|
    |--|--|
    |场景名称|设置您的场景名称，支持输入汉字、英文字母、数字和下划线（\_），长度不超过12个字符。|
    |目标产品或设备组|选择部署场景的目标产品或设备组。 目标产品或设备组中包含的设备，与您使用的场景模型关联。

    -   创建产品的操作，请参见[创建产品](/cn.zh-CN/设备接入/创建产品.md)。
    -   创建设备组的操作，请参见[设备分组](/cn.zh-CN/设备管理/设备分组.md)。 |
    |授权形式|授权形式，可分为**只读（展示）**与**读写（远程控制）**。     -   选择**只读（展示）**表示您授权第三方读取您的设备状态，展示在页面上。
    -   选择**读写（远程控制）**表示您授权第三方读取您的设备状态，并且操作您的设备来改变设备状态，主要用于对设备的远程控制。 |
    |场景模型|有两种场景模型。     -   **云端创建**：使用三维数据可视化服务提供的3D模型创建场景。后续场景的所有更新，都需要使用云端编辑器完成。
    -   **本地创建**：上传您在步骤2中制作的场景模型，使用自定义的模型创建场景。后续场景的所有更新，都需要使用本地编辑器完成并上传到三维数据可视化场景中。 |

7.  配置设备关联的参数。

    下图以三维数据可视化服务提供的Demo示例场景为例，展示设备关联内容。

    1.  双击进入下一层级，通过滚动鼠标和按左/右键调整3D模型视角。

        您也可以单击界面右上方**新手引导**，查看操作3D模型的方法。

    2.  在3D模型左上角单击**关联设备**，并在关联列表中，将您3D场景模型中的设备与IoT平台创建的设备关联起来。

        ![三维场景关联设备](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1917649951/p44103.png)

8.  设备关联完成后，分别单击3D模型中的具体设备，设置设备的弹窗配置及属性。

    ![设置设备属性](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1917649951/p44104.png)

    |参数|说明|
    |--|--|
    |弹窗配置|您首先需要设置弹窗，为设备选择勾选希望展示/操作的属性，该设置将应用到产品下所有设备中。|
    |属性|选择打开符合您设备的已设置好的属性按钮。 **说明：** 设备属性具体信息请参考[单个添加物模型](/cn.zh-CN/设备管理/物模型/单个添加物模型.md)和[批量添加属性、事件和服务](/cn.zh-CN/设备管理/物模型/批量添加物模型.md)。 |
    |事件|展示该设备所有的事件上报记录。|
    |关联设备|为该3D模拟设备关联IoT平台创建的设备。|

9.  在3D模型界面右上角单击**JS开发**，对已创建好的场景模型进行JS补充。

    具体操作方法请参见[平台部署及更新手册](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/attach/91480/cn_zh/1537238876070/ThingJS%E7%89%A9%E8%81%94%E7%BD%913D%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E5%8F%8A%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3.pdf)。

    **说明：** 三维数据可视化场景支持按创建场景时设置的刷新频率发送设备的属性信息，在**JS开发**中可以添加如下message监听代码，获取三维数据可视化场景发送的设备属性数据，方便您做更加定制化的功能开发。

    ```
    window.addEventListener('message', e => {
      const { data: { action, payload } } = e;
      if (action === 'deviceStatus') {
        console.log(payload);
      }
    });
    ```

    单击**保存**，可保存您修改的代码。

10. （可选）在场景右下角勾选标准视图前的复选框（系统自动变成自定义视图），可在自定义视图模式下，自定义设备的属性弹窗、场景分享等对话框。

    自定义视图模式下，会隐藏掉标准视图下的设备属性弹窗和分享场景对话框中的各种按钮，您可以通过在**JS开发**添加JS代码，来自定义弹窗和对话框。

    **JS开发**的具体操作方法请参见[平台部署及更新手册](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/attach/91480/cn_zh/1537238876070/ThingJS%E7%89%A9%E8%81%94%E7%BD%913D%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E5%8F%8A%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3.pdf)。

    ![标准视图自定义视图切换](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1917649951/p65064.png)

11. 在界面右上角单击各个按钮可进行更多操作。

    3D模型界面右上角：

    -   云端创建的场景中：单击**云端场景模型**，可以在线更改当前的场景模型。

        **说明：** 更改场景模型之后您需要重新关联设备，并设置各个设备的属性。

    -   本地创建的场景中：单击**场景模型**，可以更换已上传的场景模型。

        **说明：** 更换场景模型之后您需要重新关联设备，并设置各个设备的属性。

    -   单击**事件告警**，查看所有设备的告警记录。
    三维数据可视化界面右上角：

    -   单击**编辑**，可以修改除场景模型之外的场景信息。

        ![编辑场景](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1917649951/p44105.png)

    -   单击**预览**，可以全屏查看3D模型，按**Esc**键退出全屏。
    -   单击**分享**，通过两种分享方式将链接分享给其他人。

        ![场景分享](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2917649951/p44083.png)

        两种分享方式说明如下，详细的配置方法请参见[分享场景](/cn.zh-CN/物联网数据分析（老版本）/空间数据可视化/分享场景.md)。

        |分享方式|描述|
        |:---|:-|
        |授权登录访问|通过授权手机号码分享场景，适合单独使用二维数据可视化服务的场景。|
        |免登录访问|生成一个无需登录就能访问的URL，用户通过该URL直接访问已编辑好的二维数据可视化场景，适合需要将二维数据可视化做嵌入集成的用户或企业。|


