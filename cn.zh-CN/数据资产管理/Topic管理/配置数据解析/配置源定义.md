配置源定义 
==========================

创建解析任务后，您可在打开的Topic解析任务工作台，配置源定义数据作为后续Topic解析的数据源。

前提条件 
-------------------------

已创建Topic解析任务。具体操作，请参见[创建解析任务](/cn.zh-CN/数据资产管理/Topic管理/新增解析任务/创建解析任务.md)。

操作步骤 
-------------------------

1. 在Topic解析工作台画布中，默认已有 **源定义** 节点，单击该节点。

   

2. 在右侧配置面板，参照下表，完成 **基本信息** 的配置。

   ![源定义基本信息](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3898034161/p243519.gif)
   

   |  参数名称   |                 描述                 |                               相关文档                               |
   |---------|------------------------------------|------------------------------------------------------------------|
   | 所属实例    | 下拉列表展示该阿里云账号下所有实例。                 | [实例管理]()                                         |
   | 所属产品    | 下拉列表展示所选实例下所有已备份产品名称。              | [创建产品](/cn.zh-CN/设备接入/创建产品.md)                   |
   | 所属设备    | 仅支持选择 **全部设备** 。                   | [创建设备](/cn.zh-CN/设备接入/创建设备/单个创建设备.md)            |
   | Topic类型 | 可选 **自定义Topic** 和 **物模型通信Topic** 。 | [什么是Topic](/cn.zh-CN/设备接入/消息通信Topic/什么是Topic.md) |
   | Topic名称 | 选择待分析的Topic。该Topic的通信数据是解析任务的数据源。  | [什么是Topic](/cn.zh-CN/设备接入/消息通信Topic/什么是Topic.md) |

   

3. 在 **格式解析** 区域，选择 **Topic格式** 后，配置样例数据。

   

   |     Topic格式     |                                                                                                                说明                                                                                                                |
   |-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | JSON            | * 在 **样例数据** 框中，直接配置样例数据。   * 若Topic在7天内上报过数据，单击 **拉取线上数** **据** ，配置样例数据。                                                                     |
   | ProtoBuf        | 单击 **上传.desc文件** ，上传`.desc文件`后，配置样例数据。 * 选择消息类型后，单击 **上传二进制数据文件** ，配置样例数据。   * 若Topic在7天内上报过数据，单击 **拉取线上数** **据** ，配置样例数据。    |
   | Base64（to_JSON） | * 单击 **上传Base64数据文件** ，配置样例数据。   * 若Topic在7天内上报过数据，单击 **拉取线上数** **据** ，配置样例数据。                                                                |

   

4. 配置样例数据后，单击 **校验解析** 。

   若解析成功，可在 **解析预览** 中查看数据；若失败，则根据提示，修正样例数据后，重新校验。

   您可在下方 **源结构** 中查看解析字段的结构列表，包括字段名和数据类型。
   

5. 单击右上角 **保存** 。

   




后续操作 
-------------------------

[配置表达式](/cn.zh-CN/数据资产管理/Topic管理/配置数据解析/配置表达式.md)

附录：生成.desc文件 
---------------------------------

**说明**

* 您可以上传ProtoBuf格式的数据，在配置该格式的样例数据前，需先上传用于解析的`.desc`文件。

  

* 使用本功能前，您需了解Protocol Buffers的基础知识。

  




1. 下载并安装[Protocol Buffers](https://developers.google.com/protocol-buffers)。

   

2. 使用以下命令，生成`.desc`文件。

       protoc -I=/filepath1/ --descriptor_set_out=/filepath2/proto.desc /filepath3/proto.proto

   

   命令中的参数说明如下：
   

   |            参数            |                                                             说明                                                              |
   |--------------------------|-----------------------------------------------------------------------------------------------------------------------------|
   | `-I`                     | 为`--proto_path`的缩写形式。编译`.proto`文件时，指定寻找定义的`import`文件依赖的路径。 您需将其值`/filepath1/`，改为该依赖所在的路径。如果无需依赖，则更改为本地任意路径。 |
   | `--descriptor_set_out`   | 指定要生成`.desc`文件的含文件名的输出路径。 您需将其值`/filepath2/proto.desc`，改为含文件名的输出路径。                                         |
   | `/filepath3/proto.proto` | 指定源`.proto`文件的名称和路径。如需将多个文件生成`.desc`文件，可输入多个含源文件名的路径，以半角逗号（,）隔开。 您需将该值改为含该源`proto`文件名的路径。                   |

   



