配置表达式 
==========================

完成Topic源定义配置后，您可根据源定义的数据，配置字段和表达式，解析生成多样化数据，用于后续分析或输出。

前提条件 
-------------------------

已完成源定义数据配置。具体操作，请参见[配置源定义](/cn.zh-CN/数据资产管理/Topic管理/配置数据解析/配置源定义.md)。

操作步骤 
-------------------------

1. 从Topic数据解析工作台左侧的 **节点列表** 中，拖拽 **表达式** 节点到中间画布。

   **说明**

   将节点拖拽到画布后，请先从上一个节点右侧锚点连线到当前节点的左侧锚点，再进行配置。

   ![表达式](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2287401161/p225821.png)
   

2. 选中 **表达式** 节点，在右侧配置面板，显示原始字段列表。

   ![表达式](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0830070161/p224692.png)
   

3. 根据实际场景需要，修改 **数据类型** 、 **精度** 、 **小数位** 、 **字段名称** 或是否 **输出** 。

   **说明**

   只有选中输出复选框的字段，才能用于后续节点配置。
   

4. 单击 **新增字段** ，在弹出对话框中，根据页面提示，完成 **字段名称** 、 **数据类型** 、 **是否输出** 和 **表达式** 配置。

   **说明**
   * 表达式支持的函数请参见下表，各类型函数之间支持嵌套使用。

     
   
   * 表达式中的字段必须使用 **计算公式** 列的 **原始** 字段。

     
   
   * 上报的JSON数据格式，可以是数组或者嵌套的JSON。表达式中支持使用JSONPath获取其中的属性值，例如`{a:{key1:v1, key2:v2}}`，可通过`a.key2`获取到值`v2`。使用变量时，需要注意单双引号区别：单引号表示常量，双引号或不加引号表示变量。如使用单引号`'a.key2'`，值为`a.key2`。

     有关JSONPath的更多信息，请参见[LanguageManual UDF](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF?spm=a2c4g.11186623.2.41.55c034daIuruhf)。
     
   

   

   ![新增字段](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0830070161/p224693.png)
   

   |            类型             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 数学运算                      | 加（+）、减（－）、乘（×）、除（÷）、取余（％）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   | [日期函数]()  | * [DATEADD]()：按照指定的单位和幅度修改日期值。   * [DATEDIFF]()：计算两个日期的差值并按照指定的单位表示。   * [FROM_UNIXTIME]()：将数字型的UNIX值转换为日期值。   * [GETDATE]()：获取当前系统时间。   * [ISDATE]()：判断一个日期字符串能否根据指定的格式串转换为一个日期值。   * [TO_DATE]()：将指定格式的字符串转换为日期值。   * [TO_CHAR]()：将日期按照指定格式转换为字符串。   * [UNIX_TIMESTAMP]()：将日期转换为整型的UNIX格式的日期值。   * [LAST_DAY]()：返回日期值所在月份的最后一天日期。   * [CURRENT_TIMESTAMP]()：返回当前TIMESTAMP类型的时间戳。   * [FROM_UTC_TIMESTAMP]()：将一个UTC时区的时间戳转换成一个指定时区的时间戳。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   | [数学函数]()  | * [ABS]()：计算绝对值。   * [ASIN]()：计算反正弦值。   * [COS]()：计算余弦值。   * [COSH]()：计算双曲余弦值。   * [CEIL]()：计算向上取整值。   * [EXP]()：计算指数值。   * [FLOOR]()：计算向下取整值。   * [LOG]()：计算log对数值。   * [POW]()：计算幂值。   * [RAND]()：返回随机数。   * [ROUND]()：返回四舍五入到指定小数点位置的值。   * [SIN]()：计算正弦值。   * [SINH]()：计算双曲正弦值。   * [SQRT]()：计算平方根。   * [TAN]()：计算正切值。   * [TANH]()：计算双曲正切值。   * [TRUNC]()：返回截取到指定小数点位置的值。   * [HEX]()：返回整数或字符串的十六进制格式。   * [UNHEX]()：返回十六进制字符串所代表的字符串。   * [PI]()：返回π的值。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   | [字符串函数]() | * [CHR]()：将指定ASCII码转换成字符。   * [CONCAT]()：将参数中的所有字符串连接在一起。   * [GET_JSON_OBJECT]()：获取JSON字符串中的指定字符串。   * [INSTR]()：计算子字符串在整个字符串中的位置。   * [BASE64_DECODE]()：对Base64加密数据，进行Base64解码。   * [LENGTH]()：返回字符串的长度。   * [LENGTHB]()：返回字符串以字节为单位的长度。   * [MD5]()：计算字符串的MD5值。   * [REGEXP_REPLACE]()：将字符串中指定位置的子字符串替换成新字符串后返回。   * [SPLIT_PART]()：依照分隔符拆分字符串，返回指定闭区间的子串。   * [SUBSTR]()：返回字符串从指定位置开始指定长度的子串。   * [TOLOWER]()：返回英文字符串对应的小写字符串。   * [TOUPPER]()：返回英文字符串对应的大写字符串。   * [TO_CHAR]()：将BOOLEAN、BIGINT、DECIMAL或DOUBLE类型转为对应的STRING类型表示。   * [TRIM]()：去除字符串的左右空格。   * [LTRIM]()：去除字符串的左空格。   * [RTRIM]()：去除字符串的有空格。   * [REVERSE]()：返回倒序字符串。   * [ASCII]()：返回字符串第一个字符的ASCII码。   * [LPAD]()：用 **b** 字符串将 **a** 字符串向左补足到 **len** 位。   * [RPAD]()：用 **b** 字符串将 **a** 字符串向右补足到 **len** 位。   * [REPLACE]()：将字符串中指定字符串替换为新字符串后返回。   * [URL_ENCODE]()：将输入字符串编码为`application/x-www-form-urlencoded MIME`格式。   * [URL_DECODE]()：将输入字符串从`application/x-www-form-urlencoded MIME`格式转为正常字符串，是 **URL_ENCODE** 的逆过程。   * [ENDSWITH]()：判断字符串1是否以字符串2结尾。   * [TO_BASE64]()：将二进制数据转换成对应base64编码的字符串输出。    |
   | [其他函数]()  | * [CAST]()：将表达式的结果转换成目标类型。   * [COALESCE]()：返回列表中第一个非NULL的值。   * [DECODE]()：实现if-then-else分支选择的功能。   * [GREATEST]()：返回输入参数中最大的一个。   * [LEAST]()：返回输入参数中最小的一个。   * [UUID]()：返回一个随机ID。   * [CASE WHEN表达式]()：根据表达式的计算结果，灵活地返回不同的值。 **说明** 该函数中CASE表达式不支持嵌套其他函数。   * [IF表达式]()：判断指定的条件是否为真。   * [SIZE]()：返回指定MAP中的 **K/V** 对数或ARRAY中的元素数目。   * [NVL]()：如果传入的 **value** 值为NULL，返回 **default_value** 的值，否则返回 **value** 值。   * [CRYPTO]()：对指定值进行加密。   * [DEVICENAME]()：返回当前设备名称。   * [TOPIC]()：返回Topic分段信息。   * [MESSAGEID]()：返回物联网平台生成的消息ID。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

   

5. 配置完成后，单击右上角 **保存** 。

   




后续操作 
-------------------------

* 如需使用表达式中新增字段，继续生产新数据，可继续参照本文配置更多表达式。

  

* 如需配置最终输出字段，则配置目标定义节点。具体操作，请参见[配置目标定义](/cn.zh-CN/数据资产管理/Topic管理/配置数据解析/配置目标定义.md)。

  



