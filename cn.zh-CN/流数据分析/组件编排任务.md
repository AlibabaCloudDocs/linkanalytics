# 组件编排任务 {#task_ffy_jth_hfb .task}

组件编排任务是通过拖拽组件的方式，建立设备数据输入与输出的关系，通过设置属性过滤数据，也可分流数据。下文介绍如何创建一个组件编排任务。

1.  在任务管理页面，单击右上角的**创建任务**。 

    任务类型选择**组件编排**。输入任务名称和描述，选择在云端或边缘端执行任务。

    单击**确定**，新建一个组件编排类型的流计算任务。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766744036_zh-CN.png)

2.  单击**查看**，进入组件编排的页面。 

    组件编排目前支持设备输入、数据源输出、数据过滤、聚合计算四个基础组件和异常检测一个高级组件。

    可以采用拖拽的方式将组件拖入到右侧空白处进行编排。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766744037_zh-CN.png)

3.  拖拽一个设备输入组件。 

    仅支持添加一个设备输入组件。

    如果需要删除组件，需先选中组件再按delete键即可删除组件。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766744038_zh-CN.png)

    单击设备输入组件图标，右侧会弹出组件的设置窗口。

    选择设备输入组件来自于哪个产品，设备，需要哪些属性。输出节点里会相应显示选中的属性。

    **说明：** 时间和设备名称无需选择，默认会作为输出节点。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766744039_zh-CN.png)

4.  拖拽一个数据过滤节点，过滤掉不想要的数据。 

    将设备输入组件的输出和数据过滤组件的输入用线连接起来，然后单击数据过滤组件进行设置。

    下图添加了2个数据过滤条件，工作电压大于等于10和工作电流大于等于8。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844046_zh-CN.png)

    还可以再添加一个数据过滤组件，条件是第一个过滤组件的反向条件，比如工作电压小于10或工作电流小于8。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844047_zh-CN.png)

    通过数据过滤组件，即可实现数据过滤，丢弃掉不想要的数据，也可以实现数据分流。

5.  为两个流分别接上聚合计算组件。 

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844056_zh-CN.png)

    组件设置里，

    -   时间属性会默认指定
    -   可选的计算维度只会列出非数值型的，此处选择设备名称
    -   计算度量只会列出数值型的，此处选择工作电压和工作电流
    -   统计函数支持最大，最小，平均和求和，此处先选择最大和最小
    -   时间窗口指的是在多大的时间范围内进行聚合统计操作，这里选择60秒，意味着每隔60秒按照设备名称维度统计一次工作电压和工作电流的最大值和最小值。
    -   输出节点会自动显示。包括时间，设备名称，工作电压最大值，工作电流最大值，工作电压最小值和工作电流最小值。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844057_zh-CN.png)

6.  为每个流再添加一个数据源输出组件，将数据输出至数据库中。 

    单击数据源输出组件，进行设置。

    选择输出数据源和数据表，将输出节点与数据表中相关字段一一映射。

    比如，将聚合计算中产生的节点“工作电压\_最大值”与表中“max\_double”字段进行映射，那么数据导出后，可以在数据表中max\_double字段找到工作电压最大值的数据。

    **说明：** 数据表中字段数据类型需要与节点数据类型匹配。表中字段不要重复使用，每个字段对应唯一一个节点。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844058_zh-CN.png)

7.  单击下方的保存图标按钮，保存建立的任务。
8.  任务设置完毕后，单击下方的发布图标即可进行任务发布。 

    发布之后，后台会开启流计算任务进行实时计算，将计算结果不断的输出到设置的数据源的数据表中。

    **说明：** 若任务在边缘端执行，您还需参考[边缘端流数据分析](../../../../cn.zh-CN/用户指南/流数据分析/分配流数据分析到边缘实例.md#)，完成边缘任务部署。

9.  （可选）发布状态的任务可以执行撤回操作。 

    撤回之后，后台会停止流计算任务，数据源输出节点也就不会再有数据输出到数据表了。但是数据表里已有的数据还会保留。


## 异常检测 {#task_ivx_4xh_hfb}

1.  以下内容将指导您如何新建一个使用异常组件的任务。

2.  拖拽设备输入组件和异常检测组件。 

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844060_zh-CN.png)

    -   检测规则目前支持2种：连续N个点小于阈值A，连续N个点超出阈值B，这两个规则之间是或的关系，只要其中一个规则满足就会输出异常。

    -   检测属性此处先选择工作电压（只能选择一个数值型属性），假设：

        a设备上报数据的时间间隔是10秒

        b检测规则是连续3个样本数据小于阈值9

        这样如果要有3个样本则需要30秒的时间。

        如果希望样本数足够大，比如是3个样本的6倍，则时间窗口至少=30秒\*6倍=3分钟（这样能保证至少有18个样本数据）；时间窗口选择3分钟意味着会每三分钟为一个窗口去检测异常（18个样本里是否有连续3个样本数据小于阈值9），关闭后再开启下一个三分钟的窗口接着检测。

    -   输出节点为时间，检测规则，异常数据。

3.  再添加一个数据源输出组件。 

    这样检测到的异常数据就可以输出到设定的数据源里的数据表了。

4.  单击保存图标按钮，保存建立的任务。

## 维表join {#task_f3h_f2m_lgb}

1.  以下内容将指导您如何使用维表连接组件。

    使用维表连接组件，您可以将其他数据源引入组件编排一起使用，丰富数据类型。

2.  拖拽设备输入组件。
3.  拖拽维表join组件，并设置参数。 

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844061_zh-CN.png)

    -   指定希望引入的数据源（指定数据源和维表）
    -   设置连接方式，确定两个表的join方式与最终的数据集合范围，即下图阴影部分。

        目前支持两种连接方式，左图为内连接，右图为左连接。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/155545/155555766844062_zh-CN.png)

    -   新增连接条件。只有相同数据类型的主键才能连接两个表。支持添加多个连接条件。
    -   在列表中勾选希望输出的字段。其中，“主键”必须勾选。
4.  再添加一个数据源输出组件。 

    这样数据就可以输出到设定的数据源里的数据表中。

5.  单击保存图标按钮，保存建立的任务。

